<div align="center" >
    <img src="https://raw.githubusercontent.com/Alexandre-Fernandez/astro-i18n/0fb145cf64ef94968ca70c36b52a922fa897d11a/img/logo.svg" alt="astro-i18n logo" width="33%">
    <br/>
	<h1>astro-i18n</h1>
    <p>A TypeScript-first internationalization library for <a href="https://github.com/withastro/astro">Astro</a>.</p>
</div>

## Features

-   🪶 Lightweight.
-   🏗️ Build-time loading.
-   🌏 Internationalized routing.
-   🔒 Type-safety and autocompletion.
-   🔧 Support for plurals, context, interpolations and formatters.
-   🚀 Built for [Astro](https://github.com/withastro/astro) and nothing else.

## Introduction

Most internationalization libraries rely on raw untyped strings to access their translations. This is equally possible with astro-i18n however it can generate project specific types to get type-safety and autocompletion on your translations.

## Installation

```yml
# npm
npm install astro-i18n
# yarn
yarn add astro-i18n
# pnpm
pnpm add astro-i18n
```

## Get started

Run the quick install command :

```yml
./node_modules/.bin/astro-i18n install
# serverless (no filesystem/node.js setup)
./node_modules/.bin/astro-i18n install --serverless
```

Verify that your middleware file at `src/middleware.ts` or `src/middleware/index.ts` uses the `astro-i18n` middleware. If the file was generated by the quick install command it should be fine.

```ts
// src/middleware.ts
import { sequence } from "astro/middleware"
import { useAstroI18n } from "astro-i18n"

const astroI18n = useAstroI18n(/* astro-i18n config, custom formatters */)

export const onRequest = sequence(astroI18n)
```

If you are using **serverless all your initial data needs to be passed to the middleware** (mainly inside the config).

When using node (SSR or SSG) you can either go for the same workflow as serverless or use the filesystem to store your config and translations.

If you used the quick install (with node) a config file for `astro-i18n` should have been generated, you will find it in your root directory (`astro-i18n.config.(ts|js|cjs|mjs|json)`). This is exactly the same as passing it in the middleware parameters.
**Configure it as needed, you can set your `primaryLocale` and `secondaryLocales` there**.

In total you can put your translations in 4 locations :

-   Inside the middleware config.
-   Inside the config file at the root.
-   In your `src/pages` folder (local page translations), see below.
-   In the `src/i18n` directory, see below.

**`astro-i18n` works on the server-side and on the client-side** to allow it to work with client-side frameworks such as React. Because of this **translations are aggregated into groups**:

-   The `"common"` group which is accesible on every page.
-   The current page group named after its route, such as `"/about"` or `"/posts/[id]"`, as its name implies it's only accessible on the current page.
-   Any other custom group named by yourself, for example `"admin"`. It's up to you to decide on which pages your custom group is accessible.

**By default any translation accessible on the current page is visible on the client-side** (you may change that in the config).

![Filesystem translations screenshot](https://github.com/Alexandre-Fernandez/astro-i18n/blob/main/img/t.png?raw=true "Filesystem translations screenshot")

As shown in the screenshot above, local page translations can be either in `src/pages` or `src/i18n/pages`, nest them just like you do with astro file-based routing.
All the following translation file formats are valid :

```ts
const regular = `${locale}.json` // fr.json
const private = `_${locale}.json` // _fr.json
const regularWithTranslation = `${locale}.${segmentTranslation}.json` // fr.translated-page-name.json
const privateWithTranslation = `_${locale}.${segmentTranslation}.json` // _fr.translated-page-name.json
```

These files can either be directly in the page directory or grouped in a special directory called `i18n` by default.
Concerning custom groups, create a directory containing the translation files named after your group in `src/i18n`. To make them accessible in a page check the `loadingRules`.

To get **type-safety and generate your translated routes run the following command `npm run i18n:sync`**.

Once you have some translations you can use the main translation function `t` :

```ts
// src/pages/about/_i18n/en.json
{
	"my_nested": {
		"translation_key": "hello"
	}
}
// src/pages/about/_i18n/fr.a-propos.json
{
	"my_nested": {
		"translation_key": "bonjour"
	}
}
```

```ts
// src/pages/about/index.astro
import { astroI18n, t } from "astro-i18n"

astroI18n.locale // "en"
t("my_nested.translation_key") // hello

// src/pages/fr/a-propos/index.astro
import { astroI18n, t } from "astro-i18n"

astroI18n.locale // "fr"
t("my_nested.translation_key") // bonjour
```

If there's duplicate keys `t` will return the more specific one (custom group => local page => common group).

To translate a link use the `l` function :

```ts
// src/pages/fr/a-propos/index.astro
import { astroI18n, l } from "astro-i18n"

astroI18n.locale // "en"
l("/about") // "about"

// src/pages/fr/a-propos/index.astro
import { astroI18n, l } from "astro-i18n"

astroI18n.locale // "fr"
l("/about") // "a-propos"
```

That's it for the basics, for more keep reading !

## Reference

### ...

...

### ...

...

### ...

...

## CLI

...

## Contributors

<table>
	<tbody>
		<tr>
			<td align="center">
				<a href="https://github.com/Alexandre-Fernandez">
					<figure>
						<img src="https://avatars.githubusercontent.com/u/79476242?v=4?s=100" width="100px;"
							alt="Alexandre Fernandez">
						<br />
						<figcaption><sub>Alexandre Fernandez</sub></figcaption>
					</figure>
				</a>
			</td>
		</tr>
	</tbody>
</table>
